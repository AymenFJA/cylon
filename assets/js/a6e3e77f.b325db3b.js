(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{105:function(e,n,a){"use strict";a.d(n,"a",(function(){return b})),a.d(n,"b",(function(){return m}));var t=a(0),o=a.n(t);function l(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function i(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,t)}return a}function r(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?i(Object(a),!0).forEach((function(n){l(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function c(e,n){if(null==e)return{};var a,t,o=function(e,n){if(null==e)return{};var a,t,o={},l=Object.keys(e);for(t=0;t<l.length;t++)a=l[t],n.indexOf(a)>=0||(o[a]=e[a]);return o}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(t=0;t<l.length;t++)a=l[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var d=o.a.createContext({}),p=function(e){var n=o.a.useContext(d),a=n;return e&&(a="function"==typeof e?e(n):r(r({},n),e)),a},b=function(e){var n=p(e.components);return o.a.createElement(d.Provider,{value:n},e.children)},s={inlineCode:"code",wrapper:function(e){var n=e.children;return o.a.createElement(o.a.Fragment,{},n)}},u=o.a.forwardRef((function(e,n){var a=e.components,t=e.mdxType,l=e.originalType,i=e.parentName,d=c(e,["components","mdxType","originalType","parentName"]),b=p(a),u=t,m=b["".concat(i,".").concat(u)]||b[u]||s[u]||l;return a?o.a.createElement(m,r(r({ref:n},d),{},{components:a})):o.a.createElement(m,r({ref:n},d))}));function m(e,n){var a=arguments,t=n&&n.mdxType;if("string"==typeof e||t){var l=a.length,i=new Array(l);i[0]=u;var r={};for(var c in n)hasOwnProperty.call(n,c)&&(r[c]=n[c]);r.originalType=e,r.mdxType="string"==typeof e?e:t,i[1]=r;for(var d=2;d<l;d++)i[d]=a[d];return o.a.createElement.apply(null,i)}return o.a.createElement.apply(null,a)}u.displayName="MDXCreateElement"},90:function(e,n,a){"use strict";a.r(n),a.d(n,"frontMatter",(function(){return i})),a.d(n,"metadata",(function(){return r})),a.d(n,"toc",(function(){return c})),a.d(n,"default",(function(){return p}));var t=a(3),o=a(8),l=(a(0),a(105)),i={id:"conda",title:"Cylon Conda Binaries",sidebar_label:"Conda"},r={unversionedId:"conda",id:"conda",isDocsHomePage:!1,title:"Cylon Conda Binaries",description:"Cylon can be built and used through a Conda environment.",source:"@site/docs/conda.md",sourceDirName:".",slug:"/conda",permalink:"/docs/conda",editUrl:"https://github.com/cylondata/cylon/edit/master/docs/docs/conda.md",version:"current",sidebar_label:"Conda",frontMatter:{id:"conda",title:"Cylon Conda Binaries",sidebar_label:"Conda"},sidebar:"someSidebar",previous:{title:"Cylon Docker Image",permalink:"/docs/docker"},next:{title:"Python",permalink:"/docs/python"}},c=[{value:"Installing from Conda",id:"installing-from-conda",children:[]},{value:"Building in a Conda environment",id:"building-in-a-conda-environment",children:[{value:"Install Conda &amp; Prerequisites",id:"install-conda--prerequisites",children:[]},{value:"Build Cylon",id:"build-cylon",children:[]}]},{value:"Installing and Using GCylon",id:"installing-and-using-gcylon",children:[{value:"Prerequisites",id:"prerequisites",children:[]},{value:"Installing Conda Packages",id:"installing-conda-packages",children:[]}]},{value:"Setting up IDEs",id:"setting-up-ides",children:[]}],d={toc:c};function p(e){var n=e.components,a=Object(o.a)(e,["components"]);return Object(l.b)("wrapper",Object(t.a)({},d,a,{components:n,mdxType:"MDXLayout"}),Object(l.b)("p",null,"Cylon can be built and used through a Conda environment.\nThere are Conda packages for Cylon C++ and Python libraries (libcylon and pycylon)."),Object(l.b)("h2",{id:"installing-from-conda"},"Installing from Conda"),Object(l.b)("p",null,"The following command will install the latest version of Cylon."),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre",className:"language-bash"},"conda create -n cylon-dev -c cylondata pycylon python=3.7\nconda activate cylon-dev\n")),Object(l.b)("p",null,"Now you can run an example to see if everything is working fine."),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre",className:"language-python"},"from pycylon import DataFrame, CylonEnv\nfrom pycylon.net import MPIConfig\n\ndf1 = DataFrame([[1, 2, 3], [2, 3, 4]])\ndf2 = DataFrame([[1, 1, 1], [2, 3, 4]])\ndf3 = df1.merge(right=df2, on=[0, 1])\nprint(df3)\n")),Object(l.b)("h2",{id:"building-in-a-conda-environment"},"Building in a Conda environment"),Object(l.b)("p",null,"Now lets try to build Cylon in a Conda environment."),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"Ubuntu 16.04 or higher")),Object(l.b)("h3",{id:"install-conda--prerequisites"},"Install Conda & Prerequisites"),Object(l.b)("p",null,"First download and install Conda for your Linux distribution."),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre",className:"language-bash"},"sudo apt update && sudo apt upgrade\nsudo apt install software-properties-common\nsudo add-apt-repository ppa:deadsnakes/ppa\nsudo apt-get install -y --no-install-recommends --no-install-suggests libssl-dev curl wget vim git build-essential python3.7-dev python3.7 maven libnuma-dev libc-dev python3-venv openmpi-bin libopenmpi-dev python3-pip python3-dev\n")),Object(l.b)("p",null,"Here are some commands used to install conda. Note this is an example and you can choose your own version of Conda."),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre",className:"language-bash"},"wget https://repo.anaconda.com/archive/Anaconda3-2020.11-Linux-x86_64.sh\nchmod +x Anaconda3-2020.11-Linux-x86_64.sh\n./Anaconda3-2020.11-Linux-x86_64.sh\n")),Object(l.b)("p",null,"After installing conda we need to activate the conda environment. "),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre",className:"language-python"},'eval "$(~/anaconda3/bin/conda shell.bash hook)"\n')),Object(l.b)("h3",{id:"build-cylon"},"Build Cylon"),Object(l.b)("p",null,"Here are the commands to build Cylon using the conda-build. These commands will build the Cylon and PyCylon packages.\nWe need conda-build package to build Cylon."),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/cylondata/cylon.git\ncd cylon\n\nconda env create -f conda/environments/cylon.yml\nconda activate cylon_dev\n./build.sh --conda_cpp --conda_python\n")),Object(l.b)("p",null,"After that you can use PyCylon or libcylon as explained above."),Object(l.b)("p",null,"Here, Built files can be found in the ",Object(l.b)("inlineCode",{parentName:"p"},"$CYLON_HOME/build"),"\n(build directory can be specified from the command line with "),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre",className:"language-bash"},"`-bpath` flag as: ./build.sh [-bpath <build dir>] ... )\n")),Object(l.b)("p",null,"Additionally, Cylon libraries would also be installed to ",Object(l.b)("inlineCode",{parentName:"p"},"$CONDA_PREFIX/lib")," and\n",Object(l.b)("inlineCode",{parentName:"p"},"$CONDA_PREFIX/include")," directories."),Object(l.b)("h2",{id:"installing-and-using-gcylon"},"Installing and Using GCylon"),Object(l.b)("p",null,"GPU Cylon (gcylon) provides distributed dataframe processing on NVIDIA GPUs.\nThere are two libraries for gcylon: "),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"a cpp library (libgcylon) "),Object(l.b)("li",{parentName:"ul"},"a python library (pygcylon)")),Object(l.b)("p",null,"GCylon libraries depend on Cylon libraries and NVIDIA libraries: cudatoolkit and cudf"),Object(l.b)("p",null,"Since cudatoolkit and cudf libraries are rather large, we provide a separate conda environment for installing and compiling gcylon."),Object(l.b)("p",null,"The easiest way to compile and run gcylon is through a conda environment. We provide a conda environment yml file. It has all dependencies listed."),Object(l.b)("h3",{id:"prerequisites"},"Prerequisites"),Object(l.b)("ul",null,Object(l.b)("li",{parentName:"ul"},"Clone the cylon project to your machine from github if not already done."),Object(l.b)("li",{parentName:"ul"},"Make sure you have anaconda or miniconda installed. If not, please install anaconda or miniconda first. "),Object(l.b)("li",{parentName:"ul"},"Install cudatoolkit 11.0 or higher. "),Object(l.b)("li",{parentName:"ul"},"Make sure your machine is Linux and has:",Object(l.b)("ul",{parentName:"li"},Object(l.b)("li",{parentName:"ul"},"NVIDIA driver 450.80.02+"),Object(l.b)("li",{parentName:"ul"},"A GPU with Pascal architecture or better (Compute Capability >=6.0)")))),Object(l.b)("h3",{id:"installing-conda-packages"},"Installing Conda Packages"),Object(l.b)("p",null,"Go to cylon project directory on the command line."),Object(l.b)("p",null,"Check your cudatoolkit installation version. You can check it with:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"nvcc --version\n")),Object(l.b)("p",null,"If your cudatoolkit version is not 11.2, update the cudatoolkit version at the file:\nconda/environments/gcylon.yml"),Object(l.b)("p",null,"Create the conda environment and install the dependencies,\nactivate the conda environment:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"conda env create -f conda/environments/gcylon.yml\nconda activate gcylon_dev\n")),Object(l.b)("p",null,"Compile and Install Cylon cpp and python packages:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"./build.sh --conda_cpp --conda_python\n")),Object(l.b)("p",null,"Compile and Install GCylon cpp and python packages:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"./build.sh --gcylon --pygcylon\n")),Object(l.b)("p",null,"Checking whether pycylon and pygcylon packages are installed after the compilation:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},'conda list | grep cylon\npycylon                 "version number"\npygcylon                "version number"\n')),Object(l.b)("p",null,"Running the join example from gcylon examples directory:\nRunning with 2 mpi workers (-n 2) on the local machine:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"mpirun -n 2 --mca opal_cuda_support 1 python python/pygcylon/examples/join.py\n")),Object(l.b)("p",null,'To enable ucx, add the flags "--mca pml ucx --mca osc ucx" to the mpirun command.',Object(l.b)("br",{parentName:"p"}),"\n",'To enable infiniband, add the flag "--mca btl_openib_allow_ib true" to the mpirun command.',Object(l.b)("br",{parentName:"p"}),"\n","To run the join example with both ucx and infiniband enabled on the local machine with two mpi workers:"),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre"},"mpirun -n 2 --mca opal_cuda_support 1 --mca pml ucx --mca osc ucx --mca btl_openib_allow_ib true python python/pygcylon/examples/join.py\n")),Object(l.b)("p",null,"Other examples in the python/pygcylon/examples/ directory can be run similarly."),Object(l.b)("h2",{id:"setting-up-ides"},"Setting up IDEs"),Object(l.b)("p",null,"In addition to use terminal, you can also use the Conda environment in your preferred IDE's. "),Object(l.b)("ol",null,Object(l.b)("li",{parentName:"ol"},Object(l.b)("p",{parentName:"li"},"Open Cylon as a C++ project, and assign ",Object(l.b)("inlineCode",{parentName:"p"},"cylon/cpp/CmakeLists.txt")," as main CMake file.")),Object(l.b)("li",{parentName:"ol"},Object(l.b)("p",{parentName:"li"},"Export ",Object(l.b)("inlineCode",{parentName:"p"},"CONDA_PREFIX=<path to env>")," environment variable for the IDE")),Object(l.b)("li",{parentName:"ol"},Object(l.b)("p",{parentName:"li"},"Add a CMake build directory (ex: ",Object(l.b)("inlineCode",{parentName:"p"},"$CYLON_HOME/build"),")")),Object(l.b)("li",{parentName:"ol"},Object(l.b)("p",{parentName:"li"},"Use the following CMake options"))),Object(l.b)("pre",null,Object(l.b)("code",{parentName:"pre",className:"language-bash"},'-DCMAKE_INSTALL_PREFIX="$CONDA_PREFIX"\n-DARROW_BUILD_TYPE="SYSTEM"\n-DARROW_LIB_DIR="$CONDA_PREFIX/lib"\n-DARROW_INCLUDE_DIR="$CONDA_PREFIX/include"\n-DCYLON_PARQUET=ON # enable Cylon parquet \n-DPYCYLON_BUILD=ON # enable PyCylon \n-DCYLON_WITH_TEST=ON # run C++ tests \n')))}p.isMDXComponent=!0}}]);